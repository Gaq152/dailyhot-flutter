# 更新日志

所有重要的项目变更都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 计划中
- [ ] 支持分享热点到社交平台
- [ ] 添加搜索功能
- [ ] 支持收藏热点

---

## [1.3.3] - 2025-10-18

### 优化改进
- 🚀 实现三级下载降级策略，大幅提升国内下载速度和成功率
- ⚡ 添加 ghfast.top 镜像加速作为第一优先级下载源（国内高速）
- 🔄 添加 Cloudflare Workers 代理作为第二优先级备用源
- 🛡️ 保留 GitHub 原始地址作为最后保底，确保下载可靠性

### 技术实现
- UpdateInfo 类新增 mirrorUrls 字段，支持多源下载
- 实现智能下载源选择逻辑：ghfast.top → Cloudflare Workers → GitHub
- 下载失败时自动切换到下一个备用源，提升容错能力

---

## [1.3.2] - 2025-10-18

### 问题修复
- 🐛 修复冷启动超时问题：骨架屏长时间显示直到超时失败
- ⚡ 优化网络重试策略：重试次数从 5 次降至 2 次，等待时间缩短至 1-2 秒
- 🚀 大幅改善冷启动体验：总等待时间从最多 30 秒降低到 3 秒

### 安全更新
- 🔐 使用环境变量管理 API 配置，移除代码中的硬编码地址
- 🔒 GitHub Actions 通过 Secrets 动态注入配置，增强隐私安全
- ✅ .env 文件加入 .gitignore，防止敏感信息泄露

### 技术实现
- 集成 flutter_dotenv 包管理环境变量
- 在 main.dart 启动时加载 .env 配置
- app_config.dart 改用 getter 从环境变量读取 API URL
- GitHub Actions workflow 新增环境配置步骤，构建前创建 .env 文件
- 新增 .env.example 作为配置模板，方便开发者参考

---

## [1.3.1] - 2025-10-02

### 新增功能
- 🔴 更新提醒红点系统：检测到新版本后，设置图标和"检查更新"行显示醒目红点
- ⏱️ 应用运行时定期检查更新（6小时间隔），推送新版本后在线用户及时收到提示
- 💾 待更新信息持久化：点击"稍后"后信息保存，重启应用红点依然显示

### 优化改进
- ⚡ 每次启动都执行异步更新检查，去掉24小时限制，更及时获取版本更新
- 🎯 统一更新弹窗样式，主页和设置页按钮文字保持一致
- 🔄 点击"检查更新"时，有待更新信息直接显示弹窗，无需重复检查网络

### 问题修复
- 🐛 修复首页设置图标红点状态不更新的问题
- 🔧 修复下载更新后红点未消失的问题

### 技术实现
- 使用 Timer.periodic 实现应用运行时6小时定期检查
- SharedPreferences 持久化待更新版本号、下载链接、更新日志
- Badge 组件实现红点提醒，支持首页、榜单页、设置页三处显示
- dispose 时自动取消 Timer，避免内存泄漏

---

## [1.3.0] - 2025-10-02

### 新增功能
- 🔄 启动时自动检查更新功能（24小时检查一次，静默检测）
- ⚙️ 设置页面新增"自动检查更新"开关，可自由控制

### 优化改进
- ✨ 优化首页卡片滑动体验，修复在卡片上滑动无法触发页面滚动的问题
- 🎨 修复卡片底部在暗主题下的白色背景显示问题，自动适配主题色
- 🧹 精简设置项，移除无实际作用的"链接跳转方式"设置

### 技术实现
- 在 HomePage initState 中实现启动自动检查逻辑
- 使用 SharedPreferences 存储上次检查时间和开关状态
- ListView 添加 NeverScrollableScrollPhysics 解决手势冲突
- 使用 Material Design 3 颜色系统（surfaceContainerHighest、onSurfaceVariant）

---

## [1.2.0] - 2025-10-02

### 新增功能
- 🔐 配置 Release 签名密钥，统一本地和 CI 构建签名
- ✅ 支持 APK 覆盖安装更新，无需卸载旧版本

### 问题修复
- 🐛 修复应用内更新检查 HTTPS 证书握手失败问题
- 🔧 修复 UpdateService 无法访问 GitHub API 的问题

### 优化改进
- 📝 更新弹窗智能提取 CHANGELOG 内容，过滤无关信息
- 🎨 优化更新弹窗 UI，使用版本徽章和彩色容器
- 🔒 GitHub Actions 使用环境变量存储 Secrets，增强安全性

### 技术实现
- 生成 PKCS12 格式 Release 签名证书
- 配置 Android V1+V2 双签名支持
- UpdateService 配置 HTTP 客户端适配器，处理证书验证
- GitHub Actions 自动解码密钥文件并签名 APK
- 优化 workflow 配置，添加 Secrets 验证逻辑

---

## [1.1.0] - 2025-10-02

### 新增功能
- 🔄 应用内自动检查更新功能
- 📥 支持从 GitHub Releases 下载最新版本
- 📝 更新弹窗显示版本更新内容

### 问题修复
- 🐛 修复首次启动时大量请求导致超时的问题
- ⚡ 实现请求队列机制，控制并发数为 5 个
- ⏱️ 增加接收超时时间至 40 秒，适应 serverless 冷启动

### 优化改进
- 🚀 首次启动榜单逐步加载，避免同时请求 40+ 个接口
- 📊 添加项目 Logo 到 README

### 技术实现
- 新增 RequestQueueService 请求队列服务
- CHANGELOG 驱动的版本发布流程
- GitHub Actions 自动构建和发布

---

## [1.0.0] - 2025-10-01

### 新增功能
- ✨ 首次发布，支持 40+ 个热门平台热榜聚合
- 📱 支持哔哩哔哩、抖音、微博、知乎、百度等主流平台
- 🎨 支持明暗主题切换，跟随系统自动切换
- 💾 智能本地缓存，离线也能浏览历史数据
- 🔄 全局刷新和单榜刷新功能
- 📊 支持自定义榜单显示顺序和开关
- 🔗 抖音深度集成，支持直接唤起 APP
- 📝 列表文字大小自定义调节
- ⚡ 快速滚动按钮，智能切换上/下方向

### 优化改进
- 🚀 卡片加载渐入动画效果
- 🎭 榜单详情页逐条加载动画
- 💫 刷新时的流畅过渡动画
- 🎯 友好的错误提示和重试机制
- 📦 HTML 标签自动清理
- 🔧 空标题数据自动过滤

### 技术实现
- 使用 Flutter 3.24+ 构建
- Riverpod 状态管理
- Hive 本地数据库
- Dio 网络请求
- 基础项目架构搭建

---

## 版本说明

### 版本号格式：主版本号.次版本号.修订号

- **主版本号**：重大功能变更或不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 更新类型

- **新增功能**：新功能或特性
- **优化改进**：现有功能的改进
- **问题修复**：Bug 修复
- **安全更新**：安全漏洞修复
- **性能优化**：性能提升相关
- **文档更新**：仅文档变更
- **技术实现**：底层技术栈变更
